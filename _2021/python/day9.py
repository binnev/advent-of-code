from pprint import pprint

import numpy

raw = """8969799987646798965432975435334567987976999867976794468999979759865767896545699865678952123899325456
7658678998434597654321984320123458976765789998965432367998968998754556789434987654489543535698912349
6243457899325679997620195431934569765654667999993101246796856997643245679759865443356954656987894498
4102345678912998789531297659895978954213456899874512659965239876432134578998754321267899877976789987
3212466989109887678942989797659799542102345798765423867894103987543026799989866532345678999765469896
4323487893299795489899978987947689654243496789876864988943212498654135999967987765466789987654398754
5694698999987654398788967895434589879359989999987879999994467598795276789756798876567895699873219865
6788799998998975976567456899598678985498879898798989865879978939876987993145899987879954598765102987
7899899897989989875432345678998789897987968799659197654756899857989899921034999898989433459854213698
8913998766779999964321234569999897789876754678943296543434998769997797892129898789995321298765434569
9101987655767989875732345679987946689654343469764987542127899898765656789298797678976510159977675678
3212396543256878986893478999876434596543212378965698321016789999854245991987664599987621245698789789
5433495432145767897954567896985423689954301299986986432125899998762127892976553469998753457789899892
6567989543023456798966878994597434567896212989897998764234678987654679999897432348999864567997999953
7699978932124569899987989789986545678997329878798969976656789998785793599789645667898965989456789867
8988767993237678998998995678998698789865498765689654399787898999887975987689956788977899992398999879
9976458789398899687899234567999899899978987654569543219899956789998989896579899899866458943989109989
9854345679479976556954346788998999999989876543468965323987548999969498765466788956954367969878998797
8765456796567895434699459899996878998694987742556896439876439999854329654354567899875167898657897656
9896577897679966724978998943985456896513498651345689546989998898765439843212456789984356789346789843
5998678998789653219866987899876368954323489710556898768998787789876898756533568899995679891245898932
4299789349898742109654346798765458976535679921237999879867546678987989987654679978976789910234567891
5989894234969876298743234569878567899796798545346899998653434569399876599785789567987898929345688932
9878943123459865459652127999989678978998987655456789129742129679210997679897995456798987898957899543
4965431012567986798764335679598789469899998767767891019843298999429698789998932348899876767899999654
3986949143479997899865466789409892346789979879878992123969976578998539997899321467999765646978998765
2399898954567898999876567893219921235798766990999789235698895457997623456921932346998654334567899978
1299767895789999999987678999398633896899954321235695476987789598998735797899894459876543212456899899
2988956799899998989998989798976545789999896532346789569986679679439987898986789667987654201268999798
9876545788987887679899897657987656798998789987656799698785458994321299999575678978998764312349987677
8787434867976544556797623546698767987887678999767978988654356789490123985434567899799876543456997536
9643323456895433545679510134599879876765567899878969876543234899989349876423468976567998954567895215
7432102568954321234595431235678998765634345678989456998754345987879956994312469965456899996789954324
6543212349975410123489545676789769874321234789790365679976576896567898984203457896597946987898766534
7695323457897521236679686787896656965454345689621234567987687932498959876412679989989532498939878745
8986445569998934345689899998955549877965678796542347678999798940989942986567897678978901359012999987
9997556978969765456897998899643435988876789898753456789999899759878891987879976564568992459223989999
9998967889349876577896767789532123999998898999897598999988959898767790298989985323456789998939878998
9879878993212987698965656679921039876439967899999979899876545987656689349896546012367899876899767987
8867989854623999999873245567892134965323456789998765789987632496545459998765432123456998765698959876
7656799769539897895482133456954379854212597993987653999898521569632367899979643236567898754987939984
9545678998998765989321012567895459763102379932199654569765437698743458932398654387989987543656898765
8936567897899874578932123456976598765213467891034987698996548899654567891019767898999876521246789897
7623468976799765799543438967898679984324579932123498997989679998765678942423989999978988430134899998
5434578985679878997654567898939789995445698965349569876678989899876789759994596598769877321475678999
6559689643456989298775678999029895987576987896467978965457899782989899998789789429898765432386799989
7798789432345690129976789998939974599999896889878999784346998651296989876598993219989876743457898878
8989895431258789245987899987898953459878784978989989653245696542345679999457894398879987857567947566
9877987646779898659998999876567994979967643467899878964126789655456989998379965976569898967679434345
9965499867895989798999598765476789398756532456798967893235899766967998987567899879456799298989321234
9876789978954878987995459654345891296543101236987656789345678979899896798679998768345692129695433545
1988899989763567896889698743236892989754752345698545678956799998789765698789876753238789234569546656
3499949999874878945779987632123999768969643467899234589999899876578954329999875432124679945698756767
9989237999996989234567976431019888943498955989998545678989906987689965410199764321012989896799999879
8978956789997892146678986542239767832487996792987656789679215698896894321989875754123456797899989992
7867897899989921012349597953398756721276789891098767896598924599965789939878996543254597898998978991
5658998979876432124692398965986543210345996999239878965487895987654597898965987654765678949987959889
4234789767987543235789459896798765321267894878945989874356789998783456987954599875676989657995349778
2123679854987674347896569789999876543458943467956999995245894987632969876843456996787899969986234567
3012568966998989498987998677899987754567892458969899874348943986549898765652345987998999898942123679
6123456799879996579999899576789999869678943467899789965457921098798789854321234598949998677991014589
5434767959767987898998765435699987998789765598923679876767892349987698765210349899659986566789323899
8545679943854598986987654324589996689896986679013459989888999959876579894321235789898975345678946789
7676899892123999875698763215679965456965498793223598794999998799975467965452347999987654234599659899
8989986799019887654679974323467896568942349954334987653234987678894359879643458969876542123689898988
9798865678998765712578985454598987979321257895455798852109895467789234998754569653999892012567987877
7697654367897654323456798579689898989910969999579999743219654347689945679967679999549764123456896556
3598765456998768974567987689795679099899898997678987654498653201567896989898798878934965236587974449
2359987767999899765978998999964589298787656789989398765789765443489989899789897767949874347678953237
1491299879999999987889459329899999987654745894590249876899899865679876784699976456899985678789654126
0989901989789989998991399439777899898543435789931399987934999876898765633987895367899876799896543235
9877899995678978989532578998656998797632124567893989998923498989999874012346789246987989898987655345
8766798989789469878943789879546899654321012978999878999212997796799982178968992134976591997899796656
9954547878992399967899899865434678998732129899998769899929876565689875357899843239899432395698989768
7653235669991987856798999876215789987654239789987657789899765373499876567898765498798954986987878979
8762124456789996543467894989104589998768998678986545678789876212345987688959876569657995999876567999
9989012347899865432356993298913478999879876548995434345678968101356799799545987898745789865985456789
6598924456895996421245689987897567892989998756789621257989543212456893987634598999658999654986687899
7987899568934987840234567896789978921399899987898530968999964566567892396723679998767898953199789989
9876798979924987656495888934567899210198789898987649899999898788689910975435678979878997899019899975
7675356899899898767686789123679954391297698769999789799898789898799921296586789567989876798923989764
6543245698798789879899899019789995989987569543935998689765679909899892397697994345698765867894578953
8432136987657678999910998998998789778943468999899019789954234912998789998998943234989544556895678942
7543239876543457989422997867997643567892979679678929899892123893989689789989432109875432347989989431
8664345975442345678999876656789432456789895434569439998789234679876597678976543499964321235679894320
8798459864321256899987655346896563567898789212497598687679345798765326567897654989984310199998789491
9897568995438767898998643238987678689987679101789987543568996987654215458998775979996532987877578989
9987679986549878987976543129998989799986568932679876542356789099873101299439989868987543976966457577
8998790197678989756797643256899999899865457894569867421867992198764323489321098756597654965452323456
7679891998789691234598765345678923989954366789697654320378943579885654678999987643469869876321012345
4567939879896542456999975457789019878942134898789865621247894567986965699678996532398979876432123456
3459329765998653567895986568993139765899012979899876732456789678987876896599989421297989998673234568
5678909984329764678993497679954397654678923567943987654567997999799987897987678932986794569984545778
8799998965679889889989598989795986543567994578992399876799236789654398999896568943975523679995656789
9989767899789997993978999895689997562456789989989976987890145899876789998768456999854302368987789894
9879356789899876432767898764789775431634578899879765698991236799987896999654397789763213459998993912
8656244678998765321545987653459654320123456789767954019789445678998945898743235678954424668999542103
7542133569899878510126976432398797431835668892456892124689556889329236789655656789765634569987543765
6531012456789996431239954321239986545646799986587893776789678993210127898767787899879745678998955897
6542123568899987544398765510123497656656789987678954567898799654431338999978898910989656789209876789"""

# raw = """2199943210
# 3987894921
# 9856789892
# 8767896789
# 9899965678"""

raw = yangs_raw = """2127897678998676894313987643134789876543434987678932345965421298989998743210145989653456789543212456
1056789569876545679524598854545689765432123996567891959895310197678998654359239879542345699765401347
2245893458989434788965699967876789897643439875469999797689923998587899765498998765431234569543212398
9499912967898323567976989878987895999654545997348998654567899876456789876997439876510123478954394989
8978909898987456978989876989998954989897656797657897543489910975345699989875421987321235589765989978
7567899789876567899998965399969893976998767998798976701567999863245988998996410198934356678978978767
4348998678988998967897894219856789984589989999899654323488987652129876987989321239765477889989869945
5457897567899659456986789998745696943467896899998765454599986543098765435678932349876567993497657834
6667895456789542399765498899534785892356795789019876565679397653129876566789649498987899212987545125
7778943345895421989873347678921234789467893578923989879799298854234987879898798987898934929976321016
9899321256789592976432134569432345678989922459894596989998989976349999989999987546769899898765432135
2999432347899989876541015678943457989993210998789954599987676897498987696789998423856789769898543234
1397954459999875987763237789655698999875399766567895798976545789987996515569879212345678954987654659
2986896598999964399854346898767789432976987654356789997995434997676789403498765423476899123599965767
9995789987989543298765657899898994321099798765467898886789759887545693212979998534589921034598796878
8854699876578954369987867998979498752197679876878997675789898765434579439865987657678932126798689999
7653986543457965456998978997654349543986565987989876554679959876312389998654598768799874235987578924
8762399874668996789899989898763298765799434598999877323488949943101249876543329899998765399795456899
9821298765978989899789498799821019879998945689798765434567998654323347997721012987989876987654345678
5432349876789667987689234679932923998767976797669876545679239967457656985432323495479989998973234599
7653656987896549876510134569899894987656988989545998766789999896569869876554536589356999869765345678
8995767998997432989432249789789789998967899879439899987999888789689978989865787679277897659887897799
9989898999987643987543698997675678919878988768998789998997675689893989998976788792125789545998998989
7878999997898954599654567898544578909989677657896579999986524599932199867987899891014898956799449678
6567899876789867698767898987623567898796543546976467899875312679549989756798910954323457897892323579
5456789865798988789878919876544899944598652125894356799964303578998775635669892985454768998921012357
6578998974567899894989323989875678932987654034689167899875213467899654423456789876579899659434223456
7989987896698999923899569997987899321298543125679878901987824569999763214878996987897999549645394567
8999876797899889212688998976498976490129654346789989899999434598899874323989324998956798998656989678
9459865989987678923567977897319987989998776658991296798898945976789985434789909869867987899868978999
1297654578976567894599756999423498976899989769210145987757899864567897565699897654989876978979867899
2984553568997458965987649899564999985689790989921236986546789653678998987789789943299865867899756989
9873212779998569876799534768979899976797652499892959877435678954789769198993567894989764556798979878
9762102389987679987998423459998789989898743988789898764323489769899854399212456789876553545787898765
8743212387898789199987515767997657892997659975698789875212599878998765988924567898765432134456789954
7656326456899893245697623499987545943698998754894678987101278989999899876799779999874321012367899893
8766546567899994357986434989897657954569879643253459998234567899878999865678999998765432133456789762
9898757878948789469897899878798998968698765432101268999455678998767998764569898919987543245777899843
9999868999234679598798989765689209979999876954216999498677989893456789343698787934598654356889967955
8799978920134797699679976774978999989887989875425889599789598754678993201799656895679975677992459896
7678989321295989989569865443769989998765492995434678989893489866899994319987545789899896789991298789
8589995439989878976498778332356678999974321297567889476942678977945986998999334499999797998989397679
5468997698875767895359643201234589987543210198679991345894567988932199876789212357895679876578976568
6679659797664656789298756312345678998659421239989982496789978999993249765678923789964598765467895457
7892345986542547994359895423456989999798934346799976587899899999989497534679895689012349865376799345
8901239875430239965467997934767899897987945456789987698998799987878989423567789792123497654245678956
9212498765321349896778987545889987786456899569898899789987689986656679212345678989434569775678989767
4323989876732399789899987676790296654365678998987789891296569875434598993457999878945979996799799878
6539876986543987678976599789891985733234567897665678990987679986321456789569875467959899987896541989
7898775499859876547895459893999864210123789986424569989998894987432358897698764347898789999965430196
8999664369767998756789349901299754321245699875313457979869923976544789989799875456789578998965321245
9998543249878999767893298919989865452376789654201378965456894987685678979899989767895456467999432467
6987654567999999988999987998979878763589895975613456954346799898776789569978999898954314345678954578
5498975698999989999998976656867989874678934986894579893236789759887992398867899999654301236899965689
2349298789898678901987545343455699989789423987965698789345678945998931987656567898764212345679876796
1492109898796546699876532101234789999897912398876988678957899234569540198744457999865324567899989895
0989912999689134589987543212345678978986899469989976567898910123578951987632379899976545989989993934
9879899998578995679987698654896789569875678989998965458999321239699892398540256789988657997678932123
8765698766456789790198789765787893398764567899987654347698954398998789987641234997699898964567893254
9854597654345999891999999876898921296543235798999864234567895987586679998932656896569979753477894347
8966987643234899999892102987999510989792199987789542123458999878494567899843767943457965432356989456
7698998732123799999789212998984329878989987545678931015867987654343498998654588932369874321245678977
4569998754345678987678929899965498768779876534458942123989999843212989329776689643456985210124899098
3499789965456789976587898767896599654567989214347895435679899954101978910987899865677894342246789199
4987679876667998765456789656789987663412498501256896546798788943229869891298910987788999943358998989
9876578987979899754345692345678996532101987432345789657987676794398756789989439698999998896479877578
9865456899898789656236794556789987643419876567899898768976545895999545678968998549545997689589765458
7654345798765678942134895877890198984523987678998969878998436789895434799657897667939876579998642367
9743234679854567893245986798931299876634698789987656989876545998754323899546799788998655468895431345
8754123498765678965757897989949989987745789898798767999998689899895435678935688999896544356799430123
9873236789976989879998999878898679998876996955679879898549896689986547899923567899765433245678921234
4986545697698995990139998767689568999987894544578998767533934568998658997894578979854321014789932356
3497956989559024921239876553569459998998943423599569654321023456789769876789678967965762123599893467
2989899879432129892356997432488968996999862013489459785632436567899978965456999656987653234789794578
9875768968993298789997989551567899989899973124578979876545557678999989654345878943299754356997679989
9764454557989987696789876532898939879789989235689989997786878789788996543234567892129898456789567891
7653212345978999545678987656789549765678998945792398798897989897657987632123457893239876567892456910
6542103459956789223899998868899998654569467967899989549998995938545899821034578954345987678901688922
7654713998745679019998999979999869732479338998998978932389654320134789752156689766787898799213899993
8765629897634467998787889989198754321569123789987569893479765434545689843278793997898949894345789789
9886798654524346789656678993239865587678935689876458799568986755678999654689891989969435965986896698
1998987543210289899544569654345976799789545679854347678979987999799298767896989878954319876898954597
2989698954322779998623678967478989899899956898743234569989199878989129979975678969543201987989543986
9876559766433568999654567899567997974969898987642145689994299769878949989654989656994312998979691975
9965449898965878998795678978979876463456789999853234567896987654567898797643895448789429899768989987
8654323999878989319989989869899964321567899989964345678999998943478997699432689235668998798657878999
9798414598989698909978998756789876432878978879875899789898999854679876578993590123456789698743467890
9997523997694567898767899845699987643589665367996789898766898765698764356789689234577896549832579932
9899639889543458999658999434989998789696554245697893999954779977789893298999894395989965439943567893
8798998765612345987649898912978999898789432134598954989763567898899954989456976989999876598997678964
7697989954201234598732767999868899929897993249679999868322345909999899878967989878901989967989789875
6545679876345348999821656789756789101956789398999987543210458912398795967978999767892399857679991989
5434589987466467987510345897647998932345999987989998667321567893987654356799329878993998643567890995
7623491299567679875431256998734567894569878436767999779542678949876543267899410989679875432375789876
3212989998978989985432345987523458987698765425458989987654789530998764588998921393598964321234578997
4329879876899799876543467895434679398789896202345678999767897921239965799987899932987543210123456789
5498765345789654987656798976546793239999954314569789129898956892456986789676598893987654324545567895
6987653235678943298787899987897892127689965435678995398989347793678997896563456789598766436656698934
8998732123459942109898946498989921013579876566799876987673234689999498965452346995469887645787789312
9439851012567893235999532349765432123489989679899987899432124567892359764321245789312998789899896434"""

raw = """9876543212345432123456789"""


def init():
    return [list(map(int, row)) for row in raw.splitlines()]


def get_neighbours(input, x, y):
    neighbours = {}
    directions = [(x + 1, y), (x, y + 1), (x - 1, y), (x, y - 1)]
    for x, y in directions:
        if x < 0 or y < 0:
            continue
        try:
            neighbours[(x, y)] = input[y][x]
        except IndexError:
            pass
    return neighbours


def find_low_points(input):
    low_points = []
    for y, row in enumerate(input):
        for x, cell in enumerate(row):
            neighbours = get_neighbours(input, x, y).values()
            if cell < min(neighbours):
                low_points.append((x, y))
    return low_points


def part1():
    input = init()
    low_points = find_low_points(input)
    risk_level = 0
    for x, y in low_points:
        risk_level += int(input[y][x]) + 1
    return risk_level


def breadth_first_search(xy, input):
    """Each iteration
    1. get neighbours of current square
    2. add neighbours that are <= in height (add the coords)
    3. if the size of the collection didnt' change; break
    """
    x, y = xy
    basin = {(x, y)}
    while True:
        basin_size = len(basin)
        for x, y in basin:
            current_height = input[y][x]
            neighbours = get_neighbours(input, x, y)
            higher_neighbours = filter(lambda key: 9 > neighbours[key] > current_height, neighbours)
            basin = basin.union(higher_neighbours)
        # if basin didn't grow, we're done
        if len(basin) == basin_size:
            return basin


def part2():
    """
    1. find lowest points
    2. find surrounding basins (breadth first search?)
    """
    input = init()
    low_points = find_low_points(input)
    basin_sizes = []
    for low_point in low_points:
        basin = breadth_first_search(low_point, input)
        basin_sizes.append(len(basin))
    return numpy.product(sorted(basin_sizes)[-3:])


if __name__ == "__main__":
    print(f"part1: {part1()}")
    print(f"part2: {part2()}")
    # assert part1() == 522
    # assert part2() == 916688
